import XCTest
@testable import AdventOfCode2020Lib

final class CameraArrayUtilsTests: XCTestCase {
    func testBuildFullImage_withTestInput_buildFullImage() {
        let input = """
        Tile 2311:
        ..##.#..#.
        ##..#.....
        #...##..#.
        ####.#...#
        ##.##.###.
        ##...#.###
        .#.#.#..##
        ..#....#..
        ###...#.#.
        ..###..###

        Tile 1951:
        #.##...##.
        #.####...#
        .....#..##
        #...######
        .##.#....#
        .###.#####
        ###.##.##.
        .###....#.
        ..#.#..#.#
        #...##.#..

        Tile 1171:
        ####...##.
        #..##.#..#
        ##.#..#.#.
        .###.####.
        ..###.####
        .##....##.
        .#...####.
        #.##.####.
        ####..#...
        .....##...

        Tile 1427:
        ###.##.#..
        .#..#.##..
        .#.##.#..#
        #.#.#.##.#
        ....#...##
        ...##..##.
        ...#.#####
        .#.####.#.
        ..#..###.#
        ..##.#..#.

        Tile 1489:
        ##.#.#....
        ..##...#..
        .##..##...
        ..#...#...
        #####...#.
        #..#.#.#.#
        ...#.#.#..
        ##.#...##.
        ..##.##.##
        ###.##.#..

        Tile 2473:
        #....####.
        #..#.##...
        #.##..#...
        ######.#.#
        .#...#.#.#
        .#########
        .###.#..#.
        ########.#
        ##...##.#.
        ..###.#.#.

        Tile 2971:
        ..#.#....#
        #...###...
        #.#.###...
        ##.##..#..
        .#####..##
        .#..####.#
        #..#.#..#.
        ..####.###
        ..#.#.###.
        ...#.#.#.#

        Tile 2729:
        ...#.#.#.#
        ####.#....
        ..#.#.....
        ....#..#.#
        .##..##.#.
        .#.####...
        ####.#.#..
        ##.####...
        ##..#.##..
        #.##...##.

        Tile 3079:
        #.#.#####.
        .#..######
        ..#.......
        ######....
        ####.#..#.
        .#...#.##.
        #.#####.##
        ..#.###...
        ..#.......
        ..#.###...
        """
        let utils = CameraArrayUtils()
        var tiles = utils.load(from: input)
        tiles = utils.findNeighbors(images: tiles)

        let fullImage = utils.buildFullImage(fragments: tiles).map { $0.reversed() } // Output is mirrored

        XCTAssertEqual(fullImage.reduce("", { $0 + $1.reduce("", { $0 + ($1 == 1 ? "#" : ".") }) + "\n" }).trimmingCharacters(in: .newlines),
                    """
                    .#.#..#.##...#.##..#####
                    ###....#.#....#..#......
                    ##.##.###.#.#..######...
                    ###.#####...#.#####.#..#
                    ##.#....#.##.####...#.##
                    ...########.#....#####.#
                    ....#..#...##..#.#.###..
                    .####...#..#.....#......
                    #..#.##..#..###.#.##....
                    #.####..#.####.#.#.###..
                    ###.#.#...#.######.#..##
                    #.####....##..########.#
                    ##..##.#...#...#.#.#.#..
                    ...#..#..#.#.##..###.###
                    .#.#....#.##.#...###.##.
                    ###.#...#..#.##.######..
                    .#.#.###.##.##.#..#.##..
                    .####.###.#...###.#..#.#
                    ..#.#..#..#.#.#.####.###
                    #..####...#.#.#.###.###.
                    #####..#####...###....##
                    #.##..#..#...#..####...#
                    .#.###..##..##..####.##.
                    ...###...##...#...#..###
                    """
        )
    }
}
